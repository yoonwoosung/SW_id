{% extends "layout.html" %}
{% block content %}
<div class="container detail-container">
    <img src="{{ item.image }}" alt="{{ item.crop }}" class="detail-image">
    <h1>{{ item.crop }} ì²´í—˜</h1>
    <div class="detail-info">
        <p><strong>ğŸ“ ìœ„ì¹˜:</strong> {{ item.location }} (ìƒì„¸ì£¼ì†ŒëŠ” ì˜ˆì•½ í›„ ê³µê°œ)</p>
        <p><strong>ğŸŒ¿ ì¹œí™˜ê²½:</strong> {{ "ì˜ˆ" if item.pesticide_free else "ì•„ë‹ˆì˜¤" }}</p>
        <p><strong>ğŸ’° ë¹„ìš©:</strong> {{ "{:,}".format(item.cost) }}ì› / 1ì¸</p>
        <p><strong>â³ ëª¨ì§‘ ë§ˆê°:</strong> D-{{ item.d_day }} ({{ item.end_date }})</p>
    </div>

    <div class="detail-map">
        <h3>ë†ì¥ ìœ„ì¹˜</h3>
        <div id="map" style="width:100%;height:350px;"></div>
        <p style="margin-top: 10px;">ì§€ë„ ìœ„ì˜ ğŸ“ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì£¼ì†Œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>

    <div class="detail-reviews">
        </div>
    <button class="btn-submit btn-large">ì²´í—˜ ì˜ˆì•½í•˜ê¸°</button>
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_APP_KEY"></script>
<script>
    const itemData = {{ item|tojson }};

    const mapContainer = document.getElementById('map');
    const mapOption = {
        center: new kakao.maps.LatLng(itemData.lat, itemData.lng),
        level: 5
    };

    const map = new kakao.maps.Map(mapContainer, mapOption);

    const markerPosition  = new kakao.maps.LatLng(itemData.lat, itemData.lng);
    const marker = new kakao.maps.Marker({
        position: markerPosition
    });

    marker.setMap(map);

    // --- ğŸ’¡ ì´ ë¶€ë¶„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤ ---

    // ì¸í¬ìœˆë„ìš°ì— í‘œì‹œí•  ë‚´ìš© (ìƒì„¸ ì£¼ì†Œ + ê¸¸ì°¾ê¸° ë§í¬)
    const iwContent = `
        <div style="padding:5px; width:220px; font-size:12px;">
            ${itemData.address_detail}
            <br>
            <a href="https://map.kakao.com/link/to/${itemData.crop} ì²´í—˜,${itemData.lat},${itemData.lng}" style="color:blue" target="_blank">
                ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸°
            </a>
        </div>`;

    // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    const infowindow = new kakao.maps.InfoWindow({
        content : iwContent
    });

    // ë§ˆì»¤ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
    kakao.maps.event.addListener(marker, 'click', function() {
        // ë§ˆì»¤ ìœ„ì— ì¸í¬ìœˆë„ìš°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
        infowindow.open(map, marker);
    });

</script>
{% endblock %}